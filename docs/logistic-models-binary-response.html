<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" class="no-js">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Chapter 3 Logistic Models – Binary Response | CamStats</title>
<meta name="author" content="Martin van Rongen and Matt Castle">
<meta name="description" content="3.1 Objectives  Questions How do we analyse data with a binary outcome? Can we test if our model is any good? Objectives Be able to perform a logistic regression with a binary outcome Predict...">
<meta name="generator" content="bookdown 0.25 with bs4_book()">
<meta property="og:title" content="Chapter 3 Logistic Models – Binary Response | CamStats">
<meta property="og:type" content="book">
<meta property="og:description" content="3.1 Objectives  Questions How do we analyse data with a binary outcome? Can we test if our model is any good? Objectives Be able to perform a logistic regression with a binary outcome Predict...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 3 Logistic Models – Binary Response | CamStats">
<meta name="twitter:description" content="3.1 Objectives  Questions How do we analyse data with a binary outcome? Can we test if our model is any good? Objectives Be able to perform a logistic regression with a binary outcome Predict...">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Place favicon.ico & apple-touch-icon.png in the root of your domain and delete these references --><link rel="shortcut icon" href="favicon.ico">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<!-- CSS : implied media="all" --><link rel="stylesheet" type="text/css" href="stylesheets/full-stylesheet.css">
<link rel="stylesheet" type="text/css" href="stylesheets/styleguide.css">
<link rel="stylesheet" type="text/css" href="stylesheets/style.css">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/panelset-0.2.6/panelset.css" rel="stylesheet">
<script src="libs/panelset-0.2.6/panelset.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><script type="text/javascript" src="//use.typekit.com/hyb5bko.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script><script type="text/javascript">  document.documentElement.className += " js";</script>
</head>
<body class="campl-theme-2" data-spy="scroll" data-target="#toc">

<!--[if lt IE 7]>
<div class="lt-ie9 lt-ie8 lt-ie7">
<![endif]-->
<!--[if IE 7]>
<div class="lt-ie9 lt-ie8">
<![endif]-->
<!--[if IE 8]>
<div class="lt-ie9">
<![endif]-->

	<a href="#primary-nav" class="campl-skipTo">skip to primary navigation</a>
	<a href="#content" class="campl-skipTo">skip to content</a>

	<div class="campl-row campl-page-header campl-sub-section-page">
		<div class="campl-wrap clearfix">
			<div class="campl-column12">
				<div class="campl-content-container">
					<div class="campl-breadcrumb" id="breadcrumb">
						<ul class="campl-unstyled-list campl-horizontal-navigation clearfix">
<li class="first-child">
								<a href="https://bioinfotraining.bio.cam.ac.uk/" class="campl-home ir">Home</a>
							</li>
							<li>
								<a href="">Courses</a>
							</li>
							<li>
								<a href="">Training Materials</a>
							</li>
							<li>
								<a href="index.html">CamStats
							</a>
</li>
						</ul>
</div>
					<!--<p class="campl-page-title">Bioinformatics Training Materials</p>-->

					<!-- <p class="campl-mobile-parent"><a href=""><span class="campl-back-btn campl-menu-indicator"></span>Studying at Cambridge</a></p> -->
				</div>
			</div>
		</div>
	</div>

	<div class="campl-row campl-page-header">
		<div class="campl-wrap clearfix campl-local-navigation" id="local-nav">
			<div class="campl-local-navigation-container">
				<ul class="campl-unstyled-list">
<li><a href="https://training.cam.ac.uk/bioinformatics/search">Course schedule</a></li>
					<li>
<a href="#" class="campl-selected">Additional information</a>
						<ul class="campl-unstyled-list local-dropdown-menu">
<li><a href="#">Additional resources</a></li>
							<li><a href="https://bioinfotraining.bio.cam.ac.uk/about/findus">Where to find us?</a></li>
							<li><a href="#">Frequently asked questions</a></li>
						</ul>
</li>
					<li><a href="https://bioinfotraining.bio.cam.ac.uk/postgraduate">Further training</a></li>
				</ul>
</div>
		</div>



		<div class="campl-wrap clearfix campl-page-sub-title campl-recessed-sub-title">
			<div class="campl-column12">
				<div class="campl-content-container">
					<p class="campl-sub-title">CamStats</p>
				</div>
			</div>
		</div>
	</div>


		<div class="campl-row campl-content campl-recessed-content">
			<div class="campl-wrap clearfix">
				<div class="campl-column9  campl-main-content" id="content">
					<div class="campl-content-container">
						<div>
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <br><button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Overview</a></li>
<li class="book-part">Generalised linear models</li>
<li><a class="" href="glm-intro.html"><span class="header-section-number">2</span> Introduction</a></li>
<li><a class="active" href="logistic-models-binary-response.html"><span class="header-section-number">3</span> Logistic Models – Binary Response</a></li>
<li><a class="" href="logistic-regression---proportion-response.html"><span class="header-section-number">4</span> Logistic regression - proportion response</a></li>
<li class="book-part">Resampling techniques</li>
<li><a class="" href="resampling-intro.html"><span class="header-section-number">5</span> Introduction</a></li>
<li><a class="" href="single-predictor-permutation-tests.html"><span class="header-section-number">6</span> Single predictor permutation tests</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="logistic-models-binary-response" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> Logistic Models – Binary Response<a class="anchor" aria-label="anchor" href="#logistic-models-binary-response"><i class="fas fa-link"></i></a>
</h1>
<div id="objectives-1" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Objectives<a class="anchor" aria-label="anchor" href="#objectives-1"><i class="fas fa-link"></i></a>
</h2>
<div class="objectives">
<p><strong>Questions</strong></p>
<ul>
<li>How do we analyse data with a binary outcome?</li>
<li>Can we test if our model is any good?</li>
</ul>
<p><strong>Objectives</strong></p>
<ul>
<li>Be able to perform a logistic regression with a binary outcome</li>
<li>Predict outcomes of new data, based on a defined model</li>
<li>Evaluate model reliability by using training and test data sets</li>
</ul>
</div>
</div>
<div id="libraries-and-functions" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> Libraries and functions<a class="anchor" aria-label="anchor" href="#libraries-and-functions"><i class="fas fa-link"></i></a>
</h2>
<div class="panelset">
<div class="panel">
<p><span class="panel-name">tidyverse</span></p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th align="left">Library</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>tidyverse</code></td>
<td align="left">A collection of R packages designed for data science</td>
</tr>
<tr class="even">
<td align="left"><code>tidymodels</code></td>
<td align="left">A collection of packages for modelling and machine learning using tidyverse principles</td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>
<div id="datasets" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Datasets<a class="anchor" aria-label="anchor" href="#datasets"><i class="fas fa-link"></i></a>
</h2>
<div class="panelset">
<div class="panel">
<p><span class="panel-name">Diabetes</span></p>
<p>The example in this section uses the following data set:</p>
<p><code>data/diabetes.csv</code></p>
<p>This is a data set comprising 768 observations of three variables (one dependent and two predictor variables). This records the results of a diabetes test result as a binary variable (1 is a positive result, 0 is a negative result), along with the result of a glucose test and the diastolic blood pressure for each of 767 women. The variables are called <code>test_result</code>, <code>glucose</code> and <code>diastolic</code>.</p>
</div>
</div>
</div>
<div id="visualise-the-data" class="section level2" number="3.4">
<h2>
<span class="header-section-number">3.4</span> Visualise the data<a class="anchor" aria-label="anchor" href="#visualise-the-data"><i class="fas fa-link"></i></a>
</h2>
<p>First we load the data, then we visualise it. If needed, load the tidyverse package using:</p>
<div class="panelset">
<div class="panel">
<p><span class="panel-name">tidyverse</span>
First, we load and inspect the data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diabetes</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/diabetes.csv"</span><span class="op">)</span></code></pre></div>
<p>Looking at the data, we can see that the <code>test_result</code> column contains zeros and ones. These are test result outcomes and not actually numeric representations.</p>
<p>This will cause problems later, so we need to tell R to see these values as factors. For good measure we’ll also improve the information in <code>test_result</code> by classifying it as ‘negative’ (0) or ‘positive’ (1).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diabetes</span> <span class="op">&lt;-</span> 
<span class="va">diabetes</span> <span class="op">%&gt;%</span> 
  <span class="co"># replace 0 with 'negative' and 1 with 'positive'</span>
  <span class="fu">mutate</span><span class="op">(</span>test_result <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="va">test_result</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"negative"</span>,
                                 <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"positive"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co"># convert character columns to factor</span>
  <span class="fu">mutate_if</span><span class="op">(</span><span class="va">is.character</span>, <span class="va">factor</span><span class="op">)</span></code></pre></div>
<p>We can plot the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diabetes</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">test_result</span>, y <span class="op">=</span> <span class="va">glucose</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="glm-practical-logistic-binary_files/figure-html/unnamed-chunk-4-1.png" width="672"></div>
<p>It looks as though the patients with a positive diabetes test have slightly higher glucose levels than those with a negative diabetes test.</p>
<p>We can visualise that differently by plotting all the data points as a classic binary response plot:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diabetes</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">glucose</span>, y <span class="op">=</span> <span class="va">test_result</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="glm-practical-logistic-binary_files/figure-html/unnamed-chunk-5-1.png" width="672"></div>
</div>
</div>
</div>
<div id="model-building" class="section level2" number="3.5">
<h2>
<span class="header-section-number">3.5</span> Model building<a class="anchor" aria-label="anchor" href="#model-building"><i class="fas fa-link"></i></a>
</h2>
<p>There are different ways to construct a logistic model.</p>
<div class="panelset">
<div class="panel">
<p><span class="panel-name">tidyverse</span></p>
<p>In <code>tidymodels</code> we have access to a very useful package: <code>parsnip</code>, which provides a common syntax for a whole range of modelling libraries. This means that the syntax will stay the same as you do different kind of model comparisons. So, the learning curve might be a bit steeper to start with, but this will pay dividend in the long-term (just like when you started using R!).</p>
<p>First, we need to load <code>tidymodels</code> (install it first, if needed):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("tidymodels")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></code></pre></div>
<p>The workflow in <code>parsnip</code> is a bit different to what we’re used to so far. Up until now, we’ve directly used the relevant model functions to analyse our data, for example using the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function to create linear models.</p>
<p>Using <code>parsnip</code> we approach things in a more systematic manner. At first this might seem unnecessarily verbose, but there are clear advantages to approaching your analysis in a systematic way. For example, it will be straightforward to implement other types of models using the same workflow, which you’ll definitely find useful when moving on to more difficult modelling tasks.</p>
<p>Using <code>tidymodels</code> we specify a model in three steps:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Specify the type of model based on its mathematical structure</strong> (e.g., linear regression, random forest, K-nearest neighbors, etc).</li>
<li>
<strong>When required, declare the mode of the model.</strong> The mode reflects the type of prediction outcome. For numeric outcomes, the mode is regression; for qualitative outcomes, it is classification. If a model can only create one type of model, such as logistic regression, the mode is already set.</li>
<li>
<strong>Specify the engine for fitting the model.</strong> This usually is the software package or library that should be used.</li>
</ol>
<p>So, we can create the model as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_mod</span> <span class="op">&lt;-</span> <span class="fu">logistic_reg</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"glm"</span><span class="op">)</span></code></pre></div>
<p>Note that we are not actually specifying any of the variables just yet! All we’ve done is tell R what kind of model we’re planning to use. If we want to see how <code>parsnip</code> converts this code to the package syntax, we can check this with <code>translate()</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_mod</span> <span class="op">%&gt;%</span> <span class="fu">translate</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## Logistic Regression Model Specification (classification)
## 
## Computational engine: glm 
## 
## Model fit template:
## stats::glm(formula = missing_arg(), data = missing_arg(), weights = missing_arg(), 
##     family = stats::binomial)</code></pre>
<p>This shows that we have a logistic regression model, where the outcome is going to be a classification (in our case, that’s a positive or negative test result). The model fit template tells us that we’ll be using the <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> function from the <code>stats</code> package, which can take a <code>formula</code>, <code>data</code>, <code>weights</code> and <code>family</code> argument. The <code>family</code> argument is already set to binomial.</p>
<p>Now we’ve specified what kind of model we’re planning to use, we can fit our data to it, using the <code>fit()</code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_fit</span> <span class="op">&lt;-</span> <span class="va">dia_mod</span> <span class="op">%&gt;%</span> 
  <span class="fu">fit</span><span class="op">(</span><span class="va">test_result</span> <span class="op">~</span> <span class="va">glucose</span>,
      data <span class="op">=</span> <span class="va">diabetes</span><span class="op">)</span></code></pre></div>
<p>We can look at the output directly, but I prefer to tidy the data up using the <code>tidy()</code> function from <code>broom</code> package:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_fit</span> <span class="op">%&gt;%</span> <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)  -5.61     0.442       -12.7 6.90e-37
## 2 glucose       0.0395   0.00340      11.6 2.96e-31</code></pre>
<p>The <code>estimate</code> column gives you the coefficients of the logistic model equation. We could use these to calculate the probability of having a positive diabetes test, for any given glucose level, using the following equation:</p>
<p><span class="math display">\[\begin{equation}
P(positive \ test \ result) = \frac{1}{1 + {e}^{-(-5.61 +  0.040 \cdot glucose)}}
\end{equation}\]</span></p>
<p>But of course we’re not going to do it that way. We’ll let R deal with that in the next section.</p>
<p>The <code>std.error</code> column gives you the error associated with the coefficients and the <code>statistic</code> column tells you the statistic value.</p>
<p>The values in <code>p.value</code> merely show whether that particular coefficient is significantly different from zero. This is similar to the p-values obtained in the summary output of a linear model, and as before, for continuous predictors these p-values can be used as a rough guide as to whether that predictor is important (so in this case glucose appears to be significant). However, these p-values aren’t great when we have multiple predictor variables, or when we have categorical predictors with multiple levels (since the output will give us a p-value for each level rather than for the predictor as a whole).</p>
</div>
</div>
</div>
<div id="model-predictions" class="section level2" number="3.6">
<h2>
<span class="header-section-number">3.6</span> Model predictions<a class="anchor" aria-label="anchor" href="#model-predictions"><i class="fas fa-link"></i></a>
</h2>
<p>What if we got some new glucose level data and we wanted to predict if people might have diabetes or not?</p>
<p>We could use the existing model and feed it the some data:</p>
<div class="panelset">
<div class="panel">
<p><span class="panel-name">tidyverse</span></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create a dummy data set using some hypothetical glucose measurements</span>
<span class="va">diabetes_newdata</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>glucose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">188</span>, <span class="fl">122</span>, <span class="fl">83</span>, <span class="fl">76</span>, <span class="fl">144</span><span class="op">)</span><span class="op">)</span>

<span class="co"># predict if the patients have diabetes or not</span>
<span class="fu">augment</span><span class="op">(</span><span class="va">dia_fit</span>,
        new_data <span class="op">=</span> <span class="va">diabetes_newdata</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 4
##   glucose .pred_class .pred_negative .pred_positive
##     &lt;dbl&gt; &lt;fct&gt;                &lt;dbl&gt;          &lt;dbl&gt;
## 1     188 positive             0.140         0.860 
## 2     122 negative             0.688         0.312 
## 3      83 negative             0.912         0.0885
## 4      76 negative             0.931         0.0686
## 5     144 positive             0.481         0.519</code></pre>
<p>Although you are able to get the predicted outcomes (in <code>.pred_class</code>), I would like to stress that this is not the point of running the model. It is important to realise that the model (as with all statistical models) creates a predicted outcome based on certain <em>probabilities</em>. It is therefore much more informative to look at how probable these predicted outcomes are. They are encoded in <code>.pred_negative</code> and <code>.pred_positive</code>.</p>
<p>For the first value this means that there is a 14% chance that the diabetes test will return a negative result and around 86% chance that it will return a positive result.</p>
</div>
</div>
</div>
<div id="exercise-penguins" class="section level2" number="3.7">
<h2>
<span class="header-section-number">3.7</span> Exercise: Penguins<a class="anchor" aria-label="anchor" href="#exercise-penguins"><i class="fas fa-link"></i></a>
</h2>
<div class="exercise">
<p><span id="exr:unlabeled-div-1" class="exercise"><strong>Exercise 3.1  </strong></span>To practice this a bit more, we’ll be using a data set about penguins. The data are from the <code>palmerpenguins</code> package, which is included with <code>tidymodels</code>. The data set contains information on penguins at the Palmer Station on Antarctica. Chilly.</p>
<p>Have a look at the plot below, where we are comparing the bill length (<code>bill_length_mm</code>) of three species of penguins (<code>species</code>) against flipper length (<code>flipper_length_mm</code>).</p>
<p>We are also colouring the data based on sex (<code>sex</code>) and for good measure we’re also including information on the body size (<code>body_mass_g</code>).</p>
<div class="inline-figure"><img src="glm-practical-logistic-binary_files/figure-html/unnamed-chunk-12-1.png" width="672"></div>
<p>It looks like female penguins are smaller with different sized bills and it would be interesting (yes, it would!) to investigate this further.</p>
<p>I would like you to do the following:</p>
<ol style="list-style-type: decimal">
<li>load the data into an object called <code>penguins</code> using <code>data("penguins")</code>
</li>
<li>create a logistic model and fit the data to it, using <code>sex</code> as a classifier</li>
<li>is bill length an important indicator of sex?</li>
</ol>
<details><summary>
Answer
</summary><p>First, we load the data:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"penguins"</span><span class="op">)</span></code></pre></div>
<p>We already have a reasonably good idea of what we’re looking at, but it can never hurt to understand your data better, so:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 7
##   species island bill_length_mm bill_depth_mm flipper_length_… body_mass_g sex  
##   &lt;fct&gt;   &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;            &lt;int&gt;       &lt;int&gt; &lt;fct&gt;
## 1 Adelie  Torge…           39.1          18.7              181        3750 male 
## 2 Adelie  Torge…           39.5          17.4              186        3800 fema…
## 3 Adelie  Torge…           40.3          18                195        3250 fema…
## 4 Adelie  Torge…           NA            NA                 NA          NA &lt;NA&gt; 
## 5 Adelie  Torge…           36.7          19.3              193        3450 fema…
## 6 Adelie  Torge…           39.3          20.6              190        3650 male</code></pre>
<p>This shows that there are a few other columns in our data set, namely <code>island</code>, indicating the island where the penguins are residing and <code>bill_depth_mm</code> which records the bill depth.</p>
<p>We also notice that there are some missing values. It would be good to get rid of these, at least for the rows where there sex isn’t scored:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Next, we specify the type of model. Notice that it can be useful to use a prefix in the naming of these objects to indicate which data set your model belongs to. Here we’re using <em>pgn</em> to denote penguins.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pgn_mod</span> <span class="op">&lt;-</span> <span class="fu">logistic_reg</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"glm"</span><span class="op">)</span></code></pre></div>
<p>Remember, that setting the model <em>specification</em> does not yet define the model itself. We do that as follows:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pgn_fit</span> <span class="op">&lt;-</span> <span class="va">pgn_mod</span> <span class="op">%&gt;%</span> 
  <span class="fu">fit</span><span class="op">(</span><span class="va">sex</span> <span class="op">~</span> <span class="va">bill_length_mm</span>,
      data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></code></pre></div>
<p>Once we’ve fitted the data to the model, we can have a look at the model parameters:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pgn_fit</span> <span class="op">%&gt;%</span> <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 5
##   term           estimate std.error statistic       p.value
##   &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
## 1 (Intercept)      -6.04     1.01       -5.96 0.00000000247
## 2 bill_length_mm    0.138    0.0229      6.02 0.00000000176</code></pre>
<p>The model parameters tell us that both the intercept and the coefficient for <code>bill_length_mm</code> are significantly different from zero. So it seems that bill length is an important predictor of the sex of these penguins. Who knew?!</p>
</details>
</div>
</div>
<div id="model-evaluation" class="section level2" number="3.8">
<h2>
<span class="header-section-number">3.8</span> Model evaluation<a class="anchor" aria-label="anchor" href="#model-evaluation"><i class="fas fa-link"></i></a>
</h2>
<p>So far we’ve constructed the logistic model and fed it some new data to make predictions to the possible outcome of a diabetes test, depending on the glucose level of a given patient. This gave us some diabetes test predictions and, importantly, the probabilities of whether the test could come back negative or positive.</p>
<p>The question we’d like to ask ourselves at this point: how reliable is the model?</p>
<p>To explore this, we need to take a step back.</p>
<div id="split-the-data" class="section level3" number="3.8.1">
<h3>
<span class="header-section-number">3.8.1</span> Split the data<a class="anchor" aria-label="anchor" href="#split-the-data"><i class="fas fa-link"></i></a>
</h3>
<p>When we created the model, we used <em>all</em> of the data. However, a good way of assessing a model fit is to actually split the data into two:</p>
<ol style="list-style-type: decimal">
<li>a <strong>training data set</strong> that you use to fit your model</li>
<li>a <strong>test data set</strong> to validate your model and measure model performance</li>
</ol>
<p>Before we split the data, let’s have a closer look at the data set. If we count how many diabetes test results are negative and positive, we see that these counts are not evenly split.</p>
<div class="panelset">
<div class="panel">
<p><span class="panel-name">tidyverse</span></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diabetes</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">test_result</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>prop <span class="op">=</span> <span class="va">n</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   test_result     n  prop
##   &lt;fct&gt;       &lt;int&gt; &lt;dbl&gt;
## 1 negative      478 0.657
## 2 positive      250 0.343</code></pre>
<p>This can have some consequences if we start splitting our data into a training and test set. By splitting the data into two parts - where most of the data goes into your training set - you have data left afterwards that you can use to test how good the predictions of your model are. However, we need to make sure that the <em>proportion</em> of negative and positive diabetes test outcomes remains roughly the same.</p>
<p>The <code>rsample</code> package has a couple of useful functions that allow us to do just that and we can use the <code>strata</code> argument to keep these proportions more or less constant.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ensures random data split is reproducible</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>

<span class="co"># split the data, basing the proportions on the diabetes test results</span>
<span class="va">data_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">diabetes</span>, strata <span class="op">=</span> <span class="va">test_result</span><span class="op">)</span>

<span class="co"># create data frames for the two sets:</span>
<span class="va">train_data</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span>
<span class="va">test_data</span>  <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span></code></pre></div>
<p>We can check what the <code>initial_split()</code> function has done:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># proportion of data allocated to the training set</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">diabetes</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.7486264</code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># proportion of diabetes test results for the training data set</span>
<span class="va">train_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">test_result</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>prop <span class="op">=</span> <span class="va">n</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   test_result     n  prop
##   &lt;fct&gt;       &lt;int&gt; &lt;dbl&gt;
## 1 negative      358 0.657
## 2 positive      187 0.343</code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># proportion of diabetes test results for the test data set</span>
<span class="va">test_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">test_result</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>prop <span class="op">=</span> <span class="va">n</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   test_result     n  prop
##   &lt;fct&gt;       &lt;int&gt; &lt;dbl&gt;
## 1 negative      120 0.656
## 2 positive       63 0.344</code></pre>
<p>From the output we can see that around 75% of the data set has been used to create a training data set, with the remaining 25% kept as a test set.</p>
<p>Furthermore, the proportions of negative:positive are kept more or less constant.</p>
<div id="create-a-recipe" class="section level3" number="3.8.2">
<h3>
<span class="header-section-number">3.8.2</span> Create a recipe<a class="anchor" aria-label="anchor" href="#create-a-recipe"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a recipe</span>
<span class="va">dia_rec</span> <span class="op">&lt;-</span> 
  <span class="fu">recipe</span><span class="op">(</span><span class="va">test_result</span> <span class="op">~</span> <span class="va">glucose</span>, data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span>

<span class="co"># Look at the recipe summary</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">dia_rec</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
##   variable    type    role      source  
##   &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   
## 1 glucose     numeric predictor original
## 2 test_result nominal outcome   original</code></pre>
</div>
<div id="build-a-model-specification" class="section level3" number="3.8.3">
<h3>
<span class="header-section-number">3.8.3</span> Build a model specification<a class="anchor" aria-label="anchor" href="#build-a-model-specification"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_mod</span> <span class="op">&lt;-</span> 
  <span class="fu">logistic_reg</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"glm"</span><span class="op">)</span></code></pre></div>
</div>
<div id="use-recipe-as-we-train-and-test-our-model" class="section level3" number="3.8.4">
<h3>
<span class="header-section-number">3.8.4</span> Use recipe as we train and test our model<a class="anchor" aria-label="anchor" href="#use-recipe-as-we-train-and-test-our-model"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_wflow</span> <span class="op">&lt;-</span> 
  <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">add_model</span><span class="op">(</span><span class="va">dia_mod</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">dia_rec</span><span class="op">)</span>

<span class="va">dia_wflow</span></code></pre></div>
<pre><code>## ══ Workflow ════════════════════════════════════════════════════════════════════
## Preprocessor: Recipe
## Model: logistic_reg()
## 
## ── Preprocessor ────────────────────────────────────────────────────────────────
## 0 Recipe Steps
## 
## ── Model ───────────────────────────────────────────────────────────────────────
## Logistic Regression Model Specification (classification)
## 
## Computational engine: glm</code></pre>
<p>Although it seems a bit of overkill, we now have a single function that can we can use to prepare the recipe and train the model from the resulting predictors:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_fit</span> <span class="op">&lt;-</span> 
  <span class="va">dia_wflow</span> <span class="op">%&gt;%</span> 
  <span class="fu">fit</span><span class="op">(</span>data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span></code></pre></div>
<p>This creates an object called <code>dia_fit</code>, which contains the final recipe and fitted model objects. We can extract the model and recipe objects with several helper functions:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_fit</span> <span class="op">%&gt;%</span> 
  <span class="fu">extract_fit_parsnip</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)  -5.72     0.513       -11.2 6.84e-29
## 2 glucose       0.0406   0.00397      10.2 1.46e-24</code></pre>
</div>
<div id="use-trained-workflow-for-predictions" class="section level3" number="3.8.5">
<h3>
<span class="header-section-number">3.8.5</span> Use trained workflow for predictions<a class="anchor" aria-label="anchor" href="#use-trained-workflow-for-predictions"><i class="fas fa-link"></i></a>
</h3>
<p>So far, we have done the following:</p>
<ol style="list-style-type: decimal">
<li>Built the model (<code>dia_mod</code>),</li>
<li>Created a pre-processing recipe (<code>dia_rec</code>),</li>
<li>Combined the model and recipe into a workflow (<code>dia_wflow</code>)</li>
<li>Trained our workflow using the <code>fit()</code> function (<code>dia_fit</code>)</li>
</ol>
<p>The results we generated above do not differ much from the values we obtained with the entire data set. However, these are based on 3/4 of the data (our training data set). Because of this, we still have our test data set available to apply this workflow to data the model has not yet seen.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_aug</span> <span class="op">&lt;-</span> 
<span class="fu">augment</span><span class="op">(</span><span class="va">dia_fit</span>, <span class="va">test_data</span><span class="op">)</span>

<span class="va">dia_aug</span></code></pre></div>
<pre><code>## # A tibble: 183 × 6
##    glucose diastolic test_result .pred_class .pred_negative .pred_positive
##      &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;       &lt;fct&gt;                &lt;dbl&gt;          &lt;dbl&gt;
##  1      85        66 negative    negative            0.906          0.0938
##  2     183        64 positive    positive            0.152          0.848 
##  3     168        74 positive    positive            0.249          0.751 
##  4     166        72 positive    positive            0.264          0.736 
##  5     115        70 positive    negative            0.740          0.260 
##  6      99        84 negative    negative            0.845          0.155 
##  7     196        90 positive    positive            0.0959         0.904 
##  8     119        80 positive    negative            0.708          0.292 
##  9     143        94 positive    positive            0.478          0.522 
## 10      97        66 negative    negative            0.856          0.144 
## # … with 173 more rows</code></pre>
</div>
<div id="evaluate-the-model" class="section level3" number="3.8.6">
<h3>
<span class="header-section-number">3.8.6</span> Evaluate the model<a class="anchor" aria-label="anchor" href="#evaluate-the-model"><i class="fas fa-link"></i></a>
</h3>
<p>We can now evaluate the model. One way of doing this is by using the area under the ROC curve as a metric.</p>
<p>An <a href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic">ROC curve</a> (<em>receiver operating characteristic curve</em> - the name being a strange relic of WWII where developed for operators of military radar receivers) plots the true-positive rate (TPR) against the false-positive rate (FPR) at varying thresholds.</p>
<p>The true-positive rate is also known as <em>sensitivity</em>, whereas the false-positive rate is <em>1 - sensitivity</em> (which, if you recall from the session of Power Analysis is also known as the <em>power</em>.)</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_aug</span> <span class="op">%&gt;%</span> 
  <span class="fu">roc_curve</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">test_result</span>, <span class="va">.pred_negative</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">autoplot</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="glm-practical-logistic-binary_files/figure-html/unnamed-chunk-28-1.png" width="672"></div>
<p>The area under the ROC curve, which is known as the AUC provides an aggregate measure of performance across all possible classification thresholds.</p>
<p>It ranges in value from 0 to 1. A model whose predictions are 100% wrong has an AUC of 0. A model whose predictions are 100% correct has an AUC of 1.0.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_aug</span> <span class="op">%&gt;%</span> 
  <span class="fu">roc_auc</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">test_result</span>, <span class="va">.pred_negative</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 roc_auc binary         0.766</code></pre>
<p>In addition to the ROC curve and AUC we also have a whole range of model parameters associated with the fitted model. We’re not going through all of them at this point, but one in particular should be familiar.</p>
<p>We extract these parameters as follows:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_fit</span> <span class="op">%&gt;%</span> <span class="fu">glance</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 8
##   null.deviance df.null logLik   AIC   BIC deviance df.residual  nobs
##           &lt;dbl&gt;   &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;
## 1          701.     544  -277.  558.  567.     554.         543   545</code></pre>
<p>Here we see the Akaike Information Criterion (AIC) as an output. Remember, the value of the AIC in itself is meaningless, but it’s useful to compare relative to AICs of other models. We covered how to do this in the Power analysis session of the Core statistics course.</p>
<p>Here we see that the AIC for this model that uses the glucose level as a single predictor for the diabetes test result is 558.</p>
</div>
</div>
</div>
</div>
</div>
<div id="exercise-diabetes-predictors" class="section level2" number="3.9">
<h2>
<span class="header-section-number">3.9</span> Exercise: Diabetes predictors<a class="anchor" aria-label="anchor" href="#exercise-diabetes-predictors"><i class="fas fa-link"></i></a>
</h2>
<div class="exercise">
<p><span id="exr:unlabeled-div-2" class="exercise"><strong>Exercise 3.2  </strong></span>Using the training and test <code>diabetes</code> data sets, investigate the relationship between <code>test_result</code> and both <code>glucose</code> and <code>diastolic</code>. Try to answer the following:</p>
<ul>
<li>does adding <code>diastolic</code> to the model markedly improve the reliability of the predictions?</li>
<li>what do the AICs for the two models tell you?</li>
</ul>
<details><summary>
Answer
</summary><div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Update the recipe</span>
<span class="va">dia_rec</span> <span class="op">&lt;-</span> 
  <span class="fu">recipe</span><span class="op">(</span><span class="va">test_result</span> <span class="op">~</span> <span class="va">glucose</span> <span class="op">+</span> <span class="va">diastolic</span>,
         data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span>

<span class="co"># Look at the recipe summary</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">dia_rec</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 4
##   variable    type    role      source  
##   &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   
## 1 glucose     numeric predictor original
## 2 diastolic   numeric predictor original
## 3 test_result nominal outcome   original</code></pre>
<p>Build the model, if needed (we have done this already and it stays the same):</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_mod</span> <span class="op">&lt;-</span> 
  <span class="fu">logistic_reg</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"glm"</span><span class="op">)</span></code></pre></div>
<p>Create a workflow…</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_wflow</span> <span class="op">&lt;-</span> 
  <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">add_model</span><span class="op">(</span><span class="va">dia_mod</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">dia_rec</span><span class="op">)</span></code></pre></div>
<p>… and fit the data:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_fit</span> <span class="op">&lt;-</span> 
  <span class="va">dia_wflow</span> <span class="op">%&gt;%</span> 
  <span class="fu">fit</span><span class="op">(</span>data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span></code></pre></div>
<p>Extract the model parameters to have a look:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_fit</span> <span class="op">%&gt;%</span> 
  <span class="fu">extract_fit_parsnip</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)  -6.99     0.790       -8.85 8.60e-19
## 2 glucose       0.0394   0.00398      9.88 5.19e-23
## 3 diastolic     0.0195   0.00877      2.22 2.61e- 2</code></pre>
<p>Apply the fitted model to the test data set:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_aug</span> <span class="op">&lt;-</span> 
<span class="fu">augment</span><span class="op">(</span><span class="va">dia_fit</span>, <span class="va">test_data</span><span class="op">)</span>

<span class="va">dia_aug</span></code></pre></div>
<pre><code>## # A tibble: 183 × 6
##    glucose diastolic test_result .pred_class .pred_negative .pred_positive
##      &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;       &lt;fct&gt;                &lt;dbl&gt;          &lt;dbl&gt;
##  1      85        66 negative    negative            0.914          0.0862
##  2     183        64 positive    positive            0.189          0.811 
##  3     168        74 positive    positive            0.257          0.743 
##  4     166        72 positive    positive            0.280          0.720 
##  5     115        70 positive    negative            0.751          0.249 
##  6      99        84 negative    negative            0.811          0.189 
##  7     196        90 positive    positive            0.0776         0.922 
##  8     119        80 positive    negative            0.679          0.321 
##  9     143        94 positive    positive            0.385          0.615 
## 10      97        66 negative    negative            0.869          0.131 
## # … with 173 more rows</code></pre>
<p>Plot the ROC curve:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_aug</span> <span class="op">%&gt;%</span> 
  <span class="fu">roc_curve</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">test_result</span>, <span class="va">.pred_negative</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">autoplot</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="glm-practical-logistic-binary_files/figure-html/unnamed-chunk-37-1.png" width="672"></div>
<p>And get the area under the ROC curve:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_aug</span> <span class="op">%&gt;%</span> 
  <span class="fu">roc_auc</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">test_result</span>, <span class="va">.pred_negative</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 roc_auc binary         0.761</code></pre>
<p>Another way to assess the model fit is to look at the Akaike Information Criterion (AIC).</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dia_fit</span> <span class="op">%&gt;%</span> <span class="fu">glance</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 8
##   null.deviance df.null logLik   AIC   BIC deviance df.residual  nobs
##           &lt;dbl&gt;   &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;
## 1          701.     544  -275.  555.  568.     549.         542   545</code></pre>
<p>We get an AIC of 555, which is lower than the AIC of 558 that we got with just <code>glucose</code> as a predictor variable.</p>
<div id="conclusions" class="section level4" number="3.9.0.1">
<h4>
<span class="header-section-number">3.9.0.1</span> Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"><i class="fas fa-link"></i></a>
</h4>
<p>Adding the <code>diastolic</code> variable as a predictor to the model does not seem to have much of an effect on the model reliability, since the AUC is 0.761 with the extra parameter, versus 0.766 without.</p>
<p>The AIC on the other hand suggests that the additive model we’ve analysed here has a better fit than the original model (AIC of 555 vs 558).</p>
</div>
<div id="food-for-thought" class="section level4" number="3.9.0.2">
<h4>
<span class="header-section-number">3.9.0.2</span> Food for thought<a class="anchor" aria-label="anchor" href="#food-for-thought"><i class="fas fa-link"></i></a>
</h4>
<p>Perhaps there is an <em>interaction</em> between <code>glucose</code> and <code>diastolic</code>, which would be interesting to investigate.</p>

</div>
</details>
</div>
</div>
<div id="key-points" class="section level2" number="3.10">
<h2>
<span class="header-section-number">3.10</span> Key points<a class="anchor" aria-label="anchor" href="#key-points"><i class="fas fa-link"></i></a>
</h2>
<div class="keypoints">
<ul>
<li>We use a logistic regression to model a binary response</li>
<li>Model suitability can be checked by splitting the data into a training and test data set. The logistic model is then created based on the training data, and the reliability can be checked against the (known) values in the test data set</li>
<li>The ROC curve shows the performance of a classification model at all thresholds, whereas the area under the ROC curve provides an aggregate measure of performance of all possible classifications thresholds</li>
</ul>
</div>

<p><style>.panelset{--panel-tab-font-family: inherit;}</style></p>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="glm-intro.html"><span class="header-section-number">2</span> Introduction</a></div>
<div class="next"><a href="logistic-regression---proportion-response.html"><span class="header-section-number">4</span> Logistic regression - proportion response</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#logistic-models-binary-response"><span class="header-section-number">3</span> Logistic Models – Binary Response</a></li>
<li><a class="nav-link" href="#objectives-1"><span class="header-section-number">3.1</span> Objectives</a></li>
<li><a class="nav-link" href="#libraries-and-functions"><span class="header-section-number">3.2</span> Libraries and functions</a></li>
<li><a class="nav-link" href="#datasets"><span class="header-section-number">3.3</span> Datasets</a></li>
<li><a class="nav-link" href="#visualise-the-data"><span class="header-section-number">3.4</span> Visualise the data</a></li>
<li><a class="nav-link" href="#model-building"><span class="header-section-number">3.5</span> Model building</a></li>
<li><a class="nav-link" href="#model-predictions"><span class="header-section-number">3.6</span> Model predictions</a></li>
<li><a class="nav-link" href="#exercise-penguins"><span class="header-section-number">3.7</span> Exercise: Penguins</a></li>
<li>
<a class="nav-link" href="#model-evaluation"><span class="header-section-number">3.8</span> Model evaluation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#split-the-data"><span class="header-section-number">3.8.1</span> Split the data</a></li>
<li><a class="nav-link" href="#create-a-recipe"><span class="header-section-number">3.8.2</span> Create a recipe</a></li>
<li><a class="nav-link" href="#build-a-model-specification"><span class="header-section-number">3.8.3</span> Build a model specification</a></li>
<li><a class="nav-link" href="#use-recipe-as-we-train-and-test-our-model"><span class="header-section-number">3.8.4</span> Use recipe as we train and test our model</a></li>
<li><a class="nav-link" href="#use-trained-workflow-for-predictions"><span class="header-section-number">3.8.5</span> Use trained workflow for predictions</a></li>
<li><a class="nav-link" href="#evaluate-the-model"><span class="header-section-number">3.8.6</span> Evaluate the model</a></li>
</ul>
</li>
<li><a class="nav-link" href="#exercise-diabetes-predictors"><span class="header-section-number">3.9</span> Exercise: Diabetes predictors</a></li>
<li><a class="nav-link" href="#key-points"><span class="header-section-number">3.10</span> Key points</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

					</div>
				</div>

			</div>
		</div>
		<div class="campl-row campl-local-footer">
			<div class="campl-wrap clearfix">
				<div class="campl-column3 campl-footer-navigation">
					<div class="campl-content-container campl-navigation-list">
						<h3>Contact us</h3>
						 <div class="content">
						   <p>Bioinformatics Training Department of Genetics University of Cambridge Downing Street Cambridge CB2 3EH United Kingdom</p>
						   <h3>Contact:</h3> <a href="mailto:%20bioinfotraining@bio.cam.ac.uk">bioinfotraining@bio.cam.ac.uk</a>
						 </div>
					</div>
				</div>
				<div class="campl-column3 campl-footer-navigation">
					<div class="campl-content-container campl-navigation-list">
						<h3>Bioinformatics Training</h3>
						<ul class="campl-unstyled-list">
<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/undergraduate">Undergraduate training</a>
							</li>
							<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/postgraduate">Postgraduate training</a>
							</li>
						</ul>
</div>
				</div>
				<div class="campl-column3 campl-footer-navigation">
					<div class="campl-content-container campl-navigation-list">
						<h3>Postgraduate Courses by Theme</h3>
						<ul class="campl-unstyled-list">
<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/postgraduate/programming">Basic Skills and Programming</a>
							</li>
							<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/postgraduate/services">Databases and Services</a>
							</li>
							<li>
							  <a href="https://bioinfotraining.bio.cam.ac.uk/postgraduate/specialized">Specialised Topics</a>
							</li>
						</ul>
</div>
				</div>
				<div class="campl-column3 campl-footer-navigation last">
					<div class="campl-content-container campl-navigation-list">
						<h3>About Bioinformatics Training</h3>
						<ul class="campl-unstyled-list">
<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/about">About the Facility</a>
							</li>
							<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/about/findus">How to find us</a>
							</li>
							<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/about/visitors">Visiting Cambridge</a>
							</li>
							<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/privacy-and-cookie-policies">Privacy and Cookies policy</a>
							</li>
						</ul>
</div>
				</div>
			</div>
		</div>

<!--[if lte IE 8]>
</div>
<![endif]-->

	<script type="text/javascript" src="javascripts/libs/ios-orientationchange-fix.js"></script><script type="text/javascript" src="javascripts/libs/jquery-min.js"></script><script type="text/javascript" src="javascripts/libs/modernizr.js"></script><script type="text/javascript" src="javascripts/custom.js"></script><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
