<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" class="no-js">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Chapter 8 Principal component analysis (PCA) | CamStats</title>
<meta name="author" content="Martin van Rongen and Matt Castle">
<meta name="description" content="8.1 Objectives  Understand when PCAs can be useful Be able to perform a PCA Learn how to plot and interpret a screeplot Plot and interpret the loadings for each PCA   8.2 Purpose and aim This is a...">
<meta name="generator" content="bookdown 0.25 with bs4_book()">
<meta property="og:title" content="Chapter 8 Principal component analysis (PCA) | CamStats">
<meta property="og:type" content="book">
<meta property="og:description" content="8.1 Objectives  Understand when PCAs can be useful Be able to perform a PCA Learn how to plot and interpret a screeplot Plot and interpret the loadings for each PCA   8.2 Purpose and aim This is a...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 8 Principal component analysis (PCA) | CamStats">
<meta name="twitter:description" content="8.1 Objectives  Understand when PCAs can be useful Be able to perform a PCA Learn how to plot and interpret a screeplot Plot and interpret the loadings for each PCA   8.2 Purpose and aim This is a...">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Place favicon.ico & apple-touch-icon.png in the root of your domain and delete these references --><link rel="shortcut icon" href="favicon.ico">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<!-- CSS : implied media="all" --><link rel="stylesheet" type="text/css" href="stylesheets/full-stylesheet.css">
<link rel="stylesheet" type="text/css" href="stylesheets/styleguide.css">
<link rel="stylesheet" type="text/css" href="stylesheets/style.css">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/panelset-0.2.6/panelset.css" rel="stylesheet">
<script src="libs/panelset-0.2.6/panelset.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><script type="text/javascript" src="//use.typekit.com/hyb5bko.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script><script type="text/javascript">  document.documentElement.className += " js";</script>
</head>
<body class="campl-theme-2" data-spy="scroll" data-target="#toc">

<!--[if lt IE 7]>
<div class="lt-ie9 lt-ie8 lt-ie7">
<![endif]-->
<!--[if IE 7]>
<div class="lt-ie9 lt-ie8">
<![endif]-->
<!--[if IE 8]>
<div class="lt-ie9">
<![endif]-->

	<a href="#primary-nav" class="campl-skipTo">skip to primary navigation</a>
	<a href="#content" class="campl-skipTo">skip to content</a>

	<div class="campl-row campl-page-header campl-sub-section-page">
		<div class="campl-wrap clearfix">
			<div class="campl-column12">
				<div class="campl-content-container">
					<div class="campl-breadcrumb" id="breadcrumb">
						<ul class="campl-unstyled-list campl-horizontal-navigation clearfix">
<li class="first-child">
								<a href="https://bioinfotraining.bio.cam.ac.uk/" class="campl-home ir">Home</a>
							</li>
							<li>
								<a href="">Courses</a>
							</li>
							<li>
								<a href="">Training Materials</a>
							</li>
							<li>
								<a href="index.html">CamStats
							</a>
</li>
						</ul>
</div>
					<!--<p class="campl-page-title">Bioinformatics Training Materials</p>-->

					<!-- <p class="campl-mobile-parent"><a href=""><span class="campl-back-btn campl-menu-indicator"></span>Studying at Cambridge</a></p> -->
				</div>
			</div>
		</div>
	</div>

	<div class="campl-row campl-page-header">
		<div class="campl-wrap clearfix campl-local-navigation" id="local-nav">
			<div class="campl-local-navigation-container">
				<ul class="campl-unstyled-list">
<li><a href="https://training.cam.ac.uk/bioinformatics/search">Course schedule</a></li>
					<li>
<a href="#" class="campl-selected">Additional information</a>
						<ul class="campl-unstyled-list local-dropdown-menu">
<li><a href="#">Additional resources</a></li>
							<li><a href="https://bioinfotraining.bio.cam.ac.uk/about/findus">Where to find us?</a></li>
							<li><a href="#">Frequently asked questions</a></li>
						</ul>
</li>
					<li><a href="https://bioinfotraining.bio.cam.ac.uk/postgraduate">Further training</a></li>
				</ul>
</div>
		</div>



		<div class="campl-wrap clearfix campl-page-sub-title campl-recessed-sub-title">
			<div class="campl-column12">
				<div class="campl-content-container">
					<p class="campl-sub-title">CamStats</p>
				</div>
			</div>
		</div>
	</div>


		<div class="campl-row campl-content campl-recessed-content">
			<div class="campl-wrap clearfix">
				<div class="campl-column9  campl-main-content" id="content">
					<div class="campl-content-container">
						<div>
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <br><button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Overview</a></li>
<li class="book-part">Generalised linear models</li>
<li><a class="" href="glm-intro.html"><span class="header-section-number">2</span> Introduction</a></li>
<li><a class="" href="logistic-models-binary-response.html"><span class="header-section-number">3</span> Logistic Models – Binary Response</a></li>
<li><a class="" href="logistic-regression---proportion-response.html"><span class="header-section-number">4</span> Logistic regression - proportion response</a></li>
<li><a class="" href="poisson-regression-count-response.html"><span class="header-section-number">5</span> Poisson Regression – Count Response</a></li>
<li class="book-part">Resampling techniques</li>
<li><a class="" href="resampling-intro.html"><span class="header-section-number">6</span> Introduction</a></li>
<li><a class="" href="single-predictor-permutation-tests.html"><span class="header-section-number">7</span> Single predictor permutation tests</a></li>
<li class="book-part">Unsupervised learning</li>
<li><a class="active" href="principal-component-analysis-pca.html"><span class="header-section-number">8</span> Principal component analysis (PCA)</a></li>
<li><a class="" href="kmeans.html"><span class="header-section-number">9</span> K-means clustering</a></li>
<li><a class="" href="hierarchical-clustering.html"><span class="header-section-number">10</span> Hierarchical clustering</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="principal-component-analysis-pca" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Principal component analysis (PCA)<a class="anchor" aria-label="anchor" href="#principal-component-analysis-pca"><i class="fas fa-link"></i></a>
</h1>
<div id="objectives-6" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Objectives<a class="anchor" aria-label="anchor" href="#objectives-6"><i class="fas fa-link"></i></a>
</h2>
<div class="objectives">
<ul>
<li>Understand when PCAs can be useful</li>
<li>Be able to perform a PCA</li>
<li>Learn how to plot and interpret a screeplot</li>
<li>Plot and interpret the loadings for each PCA</li>
</ul>
</div>
</div>
<div id="purpose-and-aim-1" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> Purpose and aim<a class="anchor" aria-label="anchor" href="#purpose-and-aim-1"><i class="fas fa-link"></i></a>
</h2>
<p>This is a statistical technique for reducing the dimensionality of a data set. The technique aims to find a new set of variables for describing the data. These new variables are made from a weighted sum of the old variables. The weighting is chosen so that the new variables can be ranked in terms of importance in that the first new variable is chosen to account for as much variation in the data as possible. Then the second new variable is chosen to account for as much of the remaining variation in the data as possible, and so on until there are as many new variables as old variables.</p>
</div>
<div id="libraries-and-functions-4" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Libraries and functions<a class="anchor" aria-label="anchor" href="#libraries-and-functions-4"><i class="fas fa-link"></i></a>
</h2>
<div class="panelset">
<div class="panel">
<p><span class="panel-name">tidyverse</span></p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th align="left">Library</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>tidyverse</code></td>
<td align="left">A collection of R packages designed for data science</td>
</tr>
<tr class="even">
<td align="left"><code>tidymodels</code></td>
<td align="left">A collection of packages for modelling and machine learning using tidyverse principles</td>
</tr>
<tr class="odd">
<td align="left"><code>palmerpenguins</code></td>
<td align="left">Contains data sets on penguins at the Palmer Station on Antartica.</td>
</tr>
<tr class="even">
<td align="left"><code>broom</code></td>
<td align="left">Summarises key information about statistical objects in tidy tibbles</td>
</tr>
<tr class="odd">
<td align="left"><code>corrr</code></td>
<td align="left">A package for exploring correlations in R</td>
</tr>
<tr class="even">
<td align="left"><code>tidytext</code></td>
<td align="left">Makes text tidying easy</td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>
<div id="data" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Data<a class="anchor" aria-label="anchor" href="#data"><i class="fas fa-link"></i></a>
</h2>
<p>First we need some data! To liven things up a bit, we’ll be using data from the <code>palmerpenguins</code> package. This package has a whole bunch of data on penguins. What’s not to love?</p>
<div class="panelset">
<div class="panel">
<p><span class="panel-name">Penguins</span>
The <code>penguins</code> data set comes from <code>palmerpenguins</code> package (for more information, see <a href="https://github.com/allisonhorst/palmerpenguins">the GitHub page</a>).</p>
</div>
</div>
</div>
<div id="visualise-the-data-4" class="section level2" number="8.5">
<h2>
<span class="header-section-number">8.5</span> Visualise the data<a class="anchor" aria-label="anchor" href="#visualise-the-data-4"><i class="fas fa-link"></i></a>
</h2>
<p>First of all, let’s have a look at the data. It is always a good idea to get a sense of how your data.</p>
<div class="panelset">
<div class="panel">
<p><span class="panel-name">tidyverse</span>
First, we load and inspect the data:</p>
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># attach the data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">'palmerpenguins'</span><span class="op">)</span>

<span class="co"># inspect the data</span>
<span class="va">penguins</span></code></pre></div>
<pre><code>## # A tibble: 344 × 8
##    species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
##    &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
##  1 Adelie  Torgersen           39.1          18.7               181        3750
##  2 Adelie  Torgersen           39.5          17.4               186        3800
##  3 Adelie  Torgersen           40.3          18                 195        3250
##  4 Adelie  Torgersen           NA            NA                  NA          NA
##  5 Adelie  Torgersen           36.7          19.3               193        3450
##  6 Adelie  Torgersen           39.3          20.6               190        3650
##  7 Adelie  Torgersen           38.9          17.8               181        3625
##  8 Adelie  Torgersen           39.2          19.6               195        4675
##  9 Adelie  Torgersen           34.1          18.1               193        3475
## 10 Adelie  Torgersen           42            20.2               190        4250
## # … with 334 more rows, and 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
<p>We can see that there are different kinds of variables, both factors and numerical. Also, there appear to be some missing data in the data set, so we probably have to deal with that.</p>
<p>Lastly, we should be careful with the <code>year</code> column: it is recognised as a numerical column (because it contains numbers), but we should view it as a factor, since the years have a categorical meaning.</p>
<p>To get a better sense of our data we could plot all the numerical variables against each other, to see if there is any possible correlation between them. However, there are quite a few of them, so it might be easier to just create a correlation matrix.</p>
<div class="panelset">
<div class="panel">
<p><span class="panel-name">tidyverse</span>
First, we load the <code>corrr</code> package, which allows us to plot a correlation matrix using the <code>tidyverse</code> syntax:</p>
<div class="sourceCode" id="cb167"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/corrr">corrr</a></span><span class="op">)</span>

<span class="va">penguins_corr</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span>
  <span class="fu">select</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span>  <span class="co"># select the numerical columns</span>
  <span class="fu"><a href="https://corrr.tidymodels.org/reference/correlate.html">correlate</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span>                <span class="co"># calculate the correlations</span>
  <span class="fu"><a href="https://corrr.tidymodels.org/reference/rearrange.html">rearrange</a></span><span class="op">(</span><span class="op">)</span>                    <span class="co"># arrange highly correlated variables together</span></code></pre></div>
<pre><code>## 
## Correlation method: 'pearson'
## Missing treated using: 'pairwise.complete.obs'</code></pre>
<div class="sourceCode" id="cb169"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins_corr</span></code></pre></div>
<pre><code>## # A tibble: 5 × 6
##   term         flipper_length_… body_mass_g bill_length_mm    year bill_depth_mm
##   &lt;chr&gt;                   &lt;dbl&gt;       &lt;dbl&gt;          &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;
## 1 flipper_len…           NA          0.871          0.656   0.170        -0.584 
## 2 body_mass_g             0.871     NA              0.595   0.0422       -0.472 
## 3 bill_length…            0.656      0.595         NA       0.0545       -0.235 
## 4 year                    0.170      0.0422         0.0545 NA            -0.0604
## 5 bill_depth_…           -0.584     -0.472         -0.235  -0.0604       NA</code></pre>
<p>We get a message (not an error) that the correlation method used is <code>pearson</code>, which is the default. We also get a message about how the missing values are treated, with only complete pairwise comparisons made.</p>
</div>
</div>
<p>We can see that there is, for example, a strong positive correlation between <code>flipper_length_mm</code> and <code>body_mass_g</code>. Other variable combinations seem reasonably well-correlated, such as <code>flipper_length_mm</code> and <code>bill_length_mm</code> (positive) or <code>flipper_length_mm</code> and <code>bill_depth_mm</code> (negative).</p>
<p>When there are so many different variables that appear to be correlated or, if you just have lots of variables in your data and you don’t know where to look, then it can be useful to reduce the number of variables. We can do this with dimension reduction methods, of which Principal Component Analysis (PCA) is one.</p>
<p>Basically, a PCA replaces your original variables with new ones: the principal components. These principal components consist of parts of your original variables.</p>
<p>You could compare this with a smoothy consisting of, let’s say, 80% orange, 10% strawberry and 10% banana (no kale).</p>
<p>Similarly, our new principal component could consist of 80% <code>flipper_length_mm</code>, 10% <code>body_mass_g</code> and 10% <code>bill_depth_mm</code> (still no kale).</p>
</div>
<div id="performing-the-pca" class="section level2" number="8.6">
<h2>
<span class="header-section-number">8.6</span> Performing the PCA<a class="anchor" aria-label="anchor" href="#performing-the-pca"><i class="fas fa-link"></i></a>
</h2>
<div class="panelset">
<div class="panel">
<p><span class="panel-name">tidyverse</span>
Before we perform the PCA, we’ll use a few <code>recipe()</code> pre-processing steps:</p>
<ol style="list-style-type: decimal">
<li>remove any NA values</li>
<li>centre all predictors</li>
<li>scale all predictors</li>
</ol>
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguin_recipe</span> <span class="op">&lt;-</span>
  <span class="co"># take all variables</span>
  <span class="fu">recipe</span><span class="op">(</span><span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="co"># specify the ID columns (non-numerical)</span>
  <span class="fu">update_role</span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span>, <span class="va">sex</span>, <span class="va">year</span>, new_role <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="co"># remove missing values</span>
  <span class="fu">step_naomit</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="co"># scale the data</span>
  <span class="fu">step_normalize</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span>
  <span class="co"># perform the PCA</span>
  <span class="fu">step_pca</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span>, id <span class="op">=</span> <span class="st">"pca"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="co"># prepares the recipe by estimating the required parameters</span>
  <span class="fu">prep</span><span class="op">(</span><span class="op">)</span>

<span class="va">penguin_pca</span> <span class="op">&lt;-</span> 
  <span class="va">penguin_recipe</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"pca"</span><span class="op">)</span> 

<span class="va">penguin_pca</span></code></pre></div>
<pre><code>## # A tibble: 16 × 4
##    terms                value component id   
##    &lt;chr&gt;                &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;
##  1 bill_length_mm     0.455   PC1       pca  
##  2 bill_depth_mm     -0.400   PC1       pca  
##  3 flipper_length_mm  0.576   PC1       pca  
##  4 body_mass_g        0.548   PC1       pca  
##  5 bill_length_mm    -0.597   PC2       pca  
##  6 bill_depth_mm     -0.798   PC2       pca  
##  7 flipper_length_mm -0.00228 PC2       pca  
##  8 body_mass_g       -0.0844  PC2       pca  
##  9 bill_length_mm    -0.644   PC3       pca  
## 10 bill_depth_mm      0.418   PC3       pca  
## 11 flipper_length_mm  0.232   PC3       pca  
## 12 body_mass_g        0.597   PC3       pca  
## 13 bill_length_mm     0.146   PC4       pca  
## 14 bill_depth_mm     -0.168   PC4       pca  
## 15 flipper_length_mm -0.784   PC4       pca  
## 16 body_mass_g        0.580   PC4       pca</code></pre>
</div>
</div>
</div>
<div id="visualising-pcs" class="section level2" number="8.7">
<h2>
<span class="header-section-number">8.7</span> Visualising PCs<a class="anchor" aria-label="anchor" href="#visualising-pcs"><i class="fas fa-link"></i></a>
</h2>
<p>Now that we’ve performed our PCA, we can have a bit of a closer look. A useful way of looking at how much your PCs (principal components) are contributing to the amount of variance that is being explained is to create a <em>screeplot</em>. Basically, this plots the percentage of explained variance for each PC.</p>
<div class="panelset">
<div class="panel">
<p><span class="panel-name">tidyverse</span>
We can extract the relevant data directly from the <code>penguin_recipe</code> object:</p>
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguin_recipe</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"pca"</span>, type <span class="op">=</span> <span class="st">"variance"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">terms</span> <span class="op">==</span> <span class="st">"percent variance"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">component</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ylab</span><span class="op">(</span><span class="st">"% of total variance"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="clustering-practical-pca_files/figure-html/unnamed-chunk-5-1.png" width="672"></div>
</div>
</div>
<p>By definition, the first principal component (PC1) will always explain the largest amount of variation. In this case, PC1 explains almost 70% of our variance!</p>
<p>That’s pretty good going, since it means that instead of having to look at four variables, we could look at just one but still capture 70% of the variance in our data. The number of variables in our data set is very manageable, so we probably wouldn’t do this. However, if you have a data set with hundreds of variables, then seeing if they can be described well by using PCs is a very useful thing to do.</p>
</div>
<div id="loadings" class="section level2" number="8.8">
<h2>
<span class="header-section-number">8.8</span> Loadings<a class="anchor" aria-label="anchor" href="#loadings"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s think back to our smoothy metaphor. Remember how the smoothy was made up of various fruits - just like our PCs are made up of parts of our original variables.</p>
<p>Let’s, for the sake of illustrating this, assume the following for PC1:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">parts</th>
<th align="left">variable</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">4</td>
<td align="left"><code>flipper_length_mm</code></td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left"><code>body_mass_g</code></td>
</tr>
</tbody>
</table></div>
<p>Each PC has something called an <strong>eigenvector</strong>, which in simplest terms is a line with a certain direction and length.</p>
<p>If we want to calculate the length of the eigenvector for PC1, we can employ Pythagoras (well, not directly, just his legacy). This gives:</p>
<p><span class="math inline">\(eigenvector \, PC1 = \sqrt{4^2 + 1^2} = 4.12\)</span></p>
<p>The <strong>loading scores</strong> for PC1 are the “parts” scaled for this length, <em>i.e.</em>:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">scaled parts</th>
<th align="left">variable</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">4 / 4.12 = 0.97</td>
<td align="left"><code>flipper_length_mm</code></td>
</tr>
<tr class="even">
<td align="left">1 / 4.12 = 0.24</td>
<td align="left"><code>body_mass_g</code></td>
</tr>
</tbody>
</table></div>
<p>What we can do with these values is plot the loadings for each of the original variables. For example, if we plotted PC1 against PC2, and wanted to see how much the original variables contribute to each principal component, we would do the following:</p>
<div class="panelset">
<div class="panel">
<p><span class="panel-name">tidyverse</span>
The loadings are encoded in the <code>value</code> column of the pca object (<code>penguin_pca</code>). To plot this, we need the data in a “wide” format:</p>
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get pca loadings into wider format</span>
<span class="va">pca_wider</span> <span class="op">&lt;-</span> <span class="va">penguin_pca</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">component</span>, id_cols <span class="op">=</span> <span class="va">terms</span><span class="op">)</span>

<span class="va">pca_wider</span></code></pre></div>
<pre><code>## # A tibble: 4 × 5
##   terms                PC1      PC2    PC3    PC4
##   &lt;chr&gt;              &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 bill_length_mm     0.455 -0.597   -0.644  0.146
## 2 bill_depth_mm     -0.400 -0.798    0.418 -0.168
## 3 flipper_length_mm  0.576 -0.00228  0.232 -0.784
## 4 body_mass_g        0.548 -0.0844   0.597  0.580</code></pre>
<p>We can see that there are four terms (our original variables) and four PCs. This makes sense, because the maximum number of principal components cannot exceed the number of original variables.</p>
<p>We need to do a bit more data gymnastics, with defining an arrow style (vectors are represented using arrows), plotting the PCs, and plotting the loadings.</p>
<p>Arrow:</p>
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define arrow style</span>
<span class="va">arrow_style</span> <span class="op">&lt;-</span> <span class="fu">arrow</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>,
                     type <span class="op">=</span> <span class="st">"closed"</span><span class="op">)</span></code></pre></div>
<p>To plot PC1 vs PC2, we need to extract the relevant data. All of the PCA-related data is stored in the <code>penguin_recipe</code> object. Since the people who developed <code>tidymodels</code> are quite fond of verbs (I’m really more of an adjective kind-of-guy myself…) they invented the <code>bake()</code> function.</p>
<p>The logic is: you follow a <code>recipe()</code> and then you <code>bake()</code> it. Yes, I know.</p>
<p>Anyways, we use this to get the data from our <code>penguin_recipe</code>, telling the function that it shouldn’t expect any new data (the function is also used in model testing, where data is split in a training and test data set).</p>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">bake</span><span class="op">(</span><span class="va">penguin_recipe</span>, new_data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 342 × 8
##    species island    sex     year    PC1      PC2     PC3     PC4
##    &lt;fct&gt;   &lt;fct&gt;     &lt;fct&gt;  &lt;int&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 Adelie  Torgersen male    2007 -1.84  -0.0476   0.232   0.523 
##  2 Adelie  Torgersen female  2007 -1.30   0.428    0.0295  0.402 
##  3 Adelie  Torgersen female  2007 -1.37   0.154   -0.198  -0.527 
##  4 Adelie  Torgersen female  2007 -1.88   0.00205  0.618  -0.478 
##  5 Adelie  Torgersen male    2007 -1.91  -0.828    0.686  -0.207 
##  6 Adelie  Torgersen female  2007 -1.76   0.351   -0.0276  0.504 
##  7 Adelie  Torgersen male    2007 -0.809 -0.522    1.33    0.338 
##  8 Adelie  Torgersen &lt;NA&gt;    2007 -1.83   0.769    0.689  -0.427 
##  9 Adelie  Torgersen &lt;NA&gt;    2007 -1.19  -1.02     0.729   0.333 
## 10 Adelie  Torgersen &lt;NA&gt;    2007 -1.73   0.787   -0.205   0.0205
## # … with 332 more rows</code></pre>
<p>It spits out the original table, but with the PC values instead of the original variables. We can then use that information to plot the PCs, focussing here on PC1 vs PC2:</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pca_plot</span> <span class="op">&lt;-</span>
  <span class="fu">bake</span><span class="op">(</span><span class="va">penguin_recipe</span>, new_data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">PC1</span>, <span class="va">PC2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>colour <span class="op">=</span> <span class="va">species</span><span class="op">)</span>, <span class="co"># colour the data</span>
             alpha <span class="op">=</span> <span class="fl">0.8</span>,           <span class="co"># add transparency</span>
             size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>              <span class="co"># make the data points bigger</span>

<span class="va">pca_plot</span></code></pre></div>
<div class="inline-figure"><img src="clustering-practical-pca_files/figure-html/unnamed-chunk-9-1.png" width="672"></div>
<p>Lastly (finally), we take this plot and add the loading data on top of it:</p>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pca_plot</span> <span class="op">+</span>
  <span class="co"># define the vector</span>
  <span class="fu">geom_segment</span><span class="op">(</span>data <span class="op">=</span> <span class="va">pca_wider</span>,
               <span class="fu">aes</span><span class="op">(</span>xend <span class="op">=</span> <span class="va">PC1</span>, yend <span class="op">=</span> <span class="va">PC2</span><span class="op">)</span>, 
               x <span class="op">=</span> <span class="fl">0</span>, 
               y <span class="op">=</span> <span class="fl">0</span>, 
               arrow <span class="op">=</span> <span class="va">arrow_style</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co"># add the text labels</span>
  <span class="fu">geom_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">pca_wider</span>,
            <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, label <span class="op">=</span> <span class="va">terms</span><span class="op">)</span>, 
            hjust <span class="op">=</span> <span class="fl">0</span>, 
            vjust <span class="op">=</span> <span class="fl">1</span>,
            size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="clustering-practical-pca_files/figure-html/unnamed-chunk-10-1.png" width="672"></div>
</div>
</div>
<p>Slightly annoyingly, this can cause some overlap in the labels. Also, if there are many different variables than this, it’ll become rather tricky to interpret because there will be a web of vectors.</p>
<p>But here things look pretty OK still. One thing that is immediately obvious from these data is that the Gentoo penguins PCs are quite distinct from the Adelie and Chinstrap penguins.</p>
<p>From a PC-perspective, the <code>flipper_length_mm</code> and <code>body_mass_g</code> variables make up most of PC1, since the vectors are almost horizontal.</p>
<p>In contrast, <code>bill_length_mm</code> and <code>bill_depth_mm</code> contribute a lot to PC2. They also contribute positively (<code>bill_length_mm</code>) and negatively (<code>bill_depth_mm</code>) to PC1.</p>
<p>As mentioned, the vectors can become a bit messy in terms of visualisation. So it can be useful to represent the loadings differently. Note that, at this point, I’m not aware of a method that allows you to do this reasonably straightforward in anything other than R’s tidyverse.</p>
<div class="panelset">
<div class="panel">
<p><span class="panel-name">tidyverse</span>
For the following to work, we need to load the <code>tidytext</code> libary. You can do this as follows:</p>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/juliasilge/tidytext">tidytext</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguin_pca</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span>
  <span class="fu">mutate</span><span class="op">(</span>terms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/reorder_within.html">reorder_within</a></span><span class="op">(</span><span class="va">terms</span>, 
                                <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, 
                                <span class="va">component</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, <span class="va">terms</span>, fill <span class="op">=</span> <span class="va">value</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">component</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">tidytext</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/reorder_within.html">scale_y_reordered</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Absolute value of contribution"</span>,
    y <span class="op">=</span> <span class="cn">NULL</span>, fill <span class="op">=</span> <span class="st">"Positive?"</span>
  <span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="clustering-practical-pca_files/figure-html/unnamed-chunk-12-1.png" width="672"></div>
<p>This gives us the loadings for each variable, facetted by principal component. The reason that we’re plotting the <em>absolute</em> values, is so that we can compare positive and negative contributions. For each PC the absolute loadings are sorted in descending order. To distinguish between positive and negative loadings we use colours.</p>
<div class="note">
<p>It is important to keep the amount of variance explained by each PC in mind. For example, PC3 only explains around 9% of the variance. So although bill length and body mass contribute substantially to PC3, the contribution of PC3 itself remains small.</p>
</div>
</div>
</div>
</div>
<div id="exercise-heptathlon" class="section level2" number="8.9">
<h2>
<span class="header-section-number">8.9</span> Exercise: Heptathlon<a class="anchor" aria-label="anchor" href="#exercise-heptathlon"><i class="fas fa-link"></i></a>
</h2>
<div class="exercise">
<p><span id="exr:unlabeled-div-6" class="exercise"><strong>Exercise 8.1  </strong></span>First of all, heptathlon is an actual word. Seven sports events in one go! This is an old data set that keeps track of the scores/times of 25 athletes in a heptathlon event. I can’t remember when the data were collected, but the main reason that I’ve kept it is to show how fleeting the concept of ‘country’ is. A good proportion of the countries no longer exist…</p>
<p>Let’s not get too philosophical but see what we can do with this data set. I would like you to do the following:</p>
<ol style="list-style-type: decimal">
<li>load the data</li>
<li>create a correlation matrix and visualise the most highly correlated pair</li>
<li>perform a PCA</li>
<li>create a screeplot and see how many PCs would be best</li>
<li>calculate the loadings for PC1 and PC2 and visualise them</li>
</ol>
<details><summary>
Answer
</summary><div class="panelset">
<div class="panel">
<p><span class="panel-name">tidyverse</span></p>
<div id="load-the-data" class="section level3" number="8.9.1">
<h3>
<span class="header-section-number">8.9.1</span> Load the data<a class="anchor" aria-label="anchor" href="#load-the-data"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>load the data</li>
</ol>
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hept</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/heptathlon.csv"</span><span class="op">)</span>

<span class="va">hept</span></code></pre></div>
<pre><code>## # A tibble: 25 × 8
##    athlete             hurdles highjump  shot run200m longjump javelin run800m
##    &lt;chr&gt;                 &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 Joyner-Kersee (USA)    12.7     1.86  15.8    22.6     7.27    45.7    129.
##  2 John (GDR)             12.8     1.8   16.2    23.6     6.71    42.6    126.
##  3 Behmer (GDR)           13.2     1.83  14.2    23.1     6.68    44.5    124.
##  4 Sablovskaite (URS)     13.6     1.8   15.2    23.9     6.25    42.8    132.
##  5 Choubenkova (URS)      13.5     1.74  14.8    23.9     6.32    47.5    128.
##  6 Schulz (GDR)           13.8     1.83  13.5    24.6     6.33    42.8    126.
##  7 Fleming (AUS)          13.4     1.8   12.9    23.6     6.37    40.3    133.
##  8 Greiner (USA)          13.6     1.8   14.1    24.5     6.47    38      134.
##  9 Lajbnerova (CZE)       13.6     1.83  14.3    24.9     6.11    42.2    136.
## 10 Bouraga (URS)          13.2     1.77  12.6    23.6     6.28    39.1    135.
## # … with 15 more rows</code></pre>
<p>Note how many country codes have changed (URS, GDR, FRG!). Also, humbug, HOL or ‘Holland’ is not a country, The Netherlands is!. Have a search and see how the world is constantly changing…</p>
</div>
<div id="correlations" class="section level3" number="8.9.2">
<h3>
<span class="header-section-number">8.9.2</span> Correlations<a class="anchor" aria-label="anchor" href="#correlations"><i class="fas fa-link"></i></a>
</h3>
<ol start="2" style="list-style-type: decimal">
<li>create a correlation matrix and visualise the most highly correlated pair</li>
</ol>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hept_corr</span> <span class="op">&lt;-</span> <span class="va">hept</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span>
  <span class="fu">select</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span>  <span class="co"># select the numerical columns</span>
  <span class="fu"><a href="https://corrr.tidymodels.org/reference/correlate.html">correlate</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span>                <span class="co"># calculate the correlations</span>
  <span class="fu"><a href="https://corrr.tidymodels.org/reference/rearrange.html">rearrange</a></span><span class="op">(</span><span class="op">)</span>                    <span class="co"># arrange highly correlated variables together</span></code></pre></div>
<pre><code>## 
## Correlation method: 'pearson'
## Missing treated using: 'pairwise.complete.obs'</code></pre>
<div class="sourceCode" id="cb187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hept_corr</span></code></pre></div>
<pre><code>## # A tibble: 7 × 8
##   term      hurdles run200m run800m  javelin   shot highjump longjump
##   &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 hurdles  NA         0.774  0.779  -0.00776 -0.651 -0.811    -0.912 
## 2 run200m   0.774    NA      0.617  -0.333   -0.683 -0.488    -0.817 
## 3 run800m   0.779     0.617 NA       0.0200  -0.420 -0.591    -0.700 
## 4 javelin  -0.00776  -0.333  0.0200 NA        0.269  0.00215   0.0671
## 5 shot     -0.651    -0.683 -0.420   0.269   NA      0.441     0.743 
## 6 highjump -0.811    -0.488 -0.591   0.00215  0.441 NA         0.782 
## 7 longjump -0.912    -0.817 -0.700   0.0671   0.743  0.782    NA</code></pre>
<p>Looking at the correlation matrix, the most highly correlated pair is <code>longjump</code> and <code>hurdles</code> (-0.91). We could (and should) do this programmatically, but it’s a small matrix and life is short.</p>
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">hept</span>,
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longjump</span>,
           y <span class="op">=</span> <span class="va">hurdles</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"longjump vs hurdles"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="clustering-practical-pca_files/figure-html/unnamed-chunk-15-1.png" width="672"></div>
<p>So it seems that the better you are at the long jump, the faster (and thus better) you are at the hurdles. I guess that makes sense and it would be interesting to have some data on leg length to see if there is some correlation there…</p>
</div>
<div id="pca" class="section level3" number="8.9.3">
<h3>
<span class="header-section-number">8.9.3</span> PCA<a class="anchor" aria-label="anchor" href="#pca"><i class="fas fa-link"></i></a>
</h3>
<ol start="3" style="list-style-type: decimal">
<li>perform a PCA</li>
</ol>
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hept_recipe</span> <span class="op">&lt;-</span>
  <span class="co"># take all variables</span>
  <span class="fu">recipe</span><span class="op">(</span><span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">hept</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="co"># specify the ID columns (non-numerical)</span>
  <span class="fu">update_role</span><span class="op">(</span><span class="va">athlete</span>, new_role <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="co"># remove missing values</span>
  <span class="fu">step_naomit</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="co"># scale the data</span>
  <span class="fu">step_normalize</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span>
  <span class="co"># perform the PCA</span>
  <span class="fu">step_pca</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span>, id <span class="op">=</span> <span class="st">"pca"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="co"># prepares the recipe by estimating the required parameters</span>
  <span class="fu">prep</span><span class="op">(</span><span class="op">)</span>

<span class="va">hept_pca</span> <span class="op">&lt;-</span> 
  <span class="va">hept_recipe</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"pca"</span><span class="op">)</span> 

<span class="va">hept_pca</span></code></pre></div>
<pre><code>## # A tibble: 49 × 4
##    terms      value component id   
##    &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;
##  1 hurdles   0.453  PC1       pca  
##  2 highjump -0.377  PC1       pca  
##  3 shot     -0.363  PC1       pca  
##  4 run200m   0.408  PC1       pca  
##  5 longjump -0.456  PC1       pca  
##  6 javelin  -0.0754 PC1       pca  
##  7 run800m   0.375  PC1       pca  
##  8 hurdles  -0.158  PC2       pca  
##  9 highjump  0.248  PC2       pca  
## 10 shot     -0.289  PC2       pca  
## # … with 39 more rows</code></pre>
</div>
<div id="screeplot" class="section level3" number="8.9.4">
<h3>
<span class="header-section-number">8.9.4</span> Screeplot<a class="anchor" aria-label="anchor" href="#screeplot"><i class="fas fa-link"></i></a>
</h3>
<ol start="4" style="list-style-type: decimal">
<li>create a screeplot and see how many PCs would be best</li>
</ol>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hept_recipe</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"pca"</span>, type <span class="op">=</span> <span class="st">"variance"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">terms</span> <span class="op">==</span> <span class="st">"percent variance"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">component</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ylab</span><span class="op">(</span><span class="st">"% of total variance"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="clustering-practical-pca_files/figure-html/unnamed-chunk-17-1.png" width="672"></div>
<p>It’s clear that PC1 explains a heck of a lot of the variance in our data (around 65%). PC2 then explains a bit more, just under 20%. So these two PCs combined explain about 85% of the variance in our data, which is pretty good.</p>
<p>Things get a bit less clear as we go “up” in the PCs: PC3 and PC4 explain roughly the same amount of variance, so if we’d include PC3 then we should also include PC4. However, since they only explain around 8% of the variance they do not contribute much, so we leave it at PC1 and PC2.</p>
</div>
<div id="loadings-1" class="section level3" number="8.9.5">
<h3>
<span class="header-section-number">8.9.5</span> Loadings<a class="anchor" aria-label="anchor" href="#loadings-1"><i class="fas fa-link"></i></a>
</h3>
<ol start="5" style="list-style-type: decimal">
<li>calculate the loadings for PC1 and PC2 and visualise them</li>
</ol>
<p>With 7 original variables, plotting PC1 and PC2 with their loadings would be a bit unclear. So in this case we’ll just create a bar chart for each PC and the absolute contributions of each original variable.</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hept_pca</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">component</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PC1"</span>, <span class="st">"PC2"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="fu">mutate</span><span class="op">(</span>terms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/reorder_within.html">reorder_within</a></span><span class="op">(</span><span class="va">terms</span>, 
                                <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, 
                                <span class="va">component</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, <span class="va">terms</span>, fill <span class="op">=</span> <span class="va">value</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">component</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">tidytext</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/reorder_within.html">scale_y_reordered</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Absolute value of contribution"</span>,
    y <span class="op">=</span> <span class="cn">NULL</span>, fill <span class="op">=</span> <span class="st">"Positive?"</span>
  <span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="clustering-practical-pca_files/figure-html/unnamed-chunk-18-1.png" width="672"></div>
<p>Just to illustrate that this is much more informative than drawing vectors:</p>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get pca loadings into wider format</span>
<span class="va">pca_wider</span> <span class="op">&lt;-</span> <span class="va">hept_pca</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span> 
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">component</span>, id_cols <span class="op">=</span> <span class="va">terms</span><span class="op">)</span>

<span class="va">pca_plot</span> <span class="op">&lt;-</span>
  <span class="fu">bake</span><span class="op">(</span><span class="va">hept_recipe</span>, new_data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/janitor/man/pipe.html">%&gt;%</a></span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">PC1</span>, <span class="va">PC2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.8</span>, <span class="co"># add transparency</span>
             size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>    <span class="co"># make the data points bigger</span>

<span class="co"># define arrow style</span>
<span class="va">arrow_style</span> <span class="op">&lt;-</span> <span class="fu">arrow</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>,
                     type <span class="op">=</span> <span class="st">"closed"</span><span class="op">)</span>

<span class="va">pca_plot</span> <span class="op">+</span>
  <span class="co"># define the vector</span>
  <span class="fu">geom_segment</span><span class="op">(</span>data <span class="op">=</span> <span class="va">pca_wider</span>,
               <span class="fu">aes</span><span class="op">(</span>xend <span class="op">=</span> <span class="va">PC1</span>, yend <span class="op">=</span> <span class="va">PC2</span><span class="op">)</span>, 
               x <span class="op">=</span> <span class="fl">0</span>, 
               y <span class="op">=</span> <span class="fl">0</span>, 
               arrow <span class="op">=</span> <span class="va">arrow_style</span>,
               colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co"># add the text labels</span>
  <span class="fu">geom_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">pca_wider</span>,
            <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, label <span class="op">=</span> <span class="va">terms</span><span class="op">)</span>, 
            hjust <span class="op">=</span> <span class="fl">0</span>, 
            vjust <span class="op">=</span> <span class="fl">1</span>,
            size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="clustering-practical-pca_files/figure-html/unnamed-chunk-19-1.png" width="672"></div>
<p>Told ya.</p>
</div>
</div>
</div>
<div id="conclusion" class="section level3" number="8.9.6">
<h3>
<span class="header-section-number">8.9.6</span> Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"><i class="fas fa-link"></i></a>
</h3>
<p>Well, what can we conclude here? First of all, it’s worth noting that there are only 25 observations and 7 variables, so that limits our analysis a bit.</p>
<p>We can see that PC1 (particularly when combined with PC2) is able to explain quite a big chunk of the variance in our data. However, we should keep in mind that each observation is an individual athlete. So ideally we would want to plot the names of the athletes on the PC1 vs PC2 plot and see how their individual performances in the 7 events compare.</p>
That, is for another day.

</div>
</details>
</div>
</div>
<div id="key-points-4" class="section level2" number="8.10">
<h2>
<span class="header-section-number">8.10</span> Key points<a class="anchor" aria-label="anchor" href="#key-points-4"><i class="fas fa-link"></i></a>
</h2>
<div class="keypoints">
<ul>
<li>PCA allows you to reduce a large number of variables into fewer principal components</li>
<li>Each PC is made up of a combination of the original variables and captures as much of the variance within the data as possible</li>
<li>The loadings tell you how much each original variable contributes to each PC</li>
<li>A screeplot is a graphical representation of the amount of variance explained by each PC</li>
</ul>
</div>

<p><style>.panelset{--panel-tab-font-family: inherit;}</style></p>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="single-predictor-permutation-tests.html"><span class="header-section-number">7</span> Single predictor permutation tests</a></div>
<div class="next"><a href="kmeans.html"><span class="header-section-number">9</span> K-means clustering</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#principal-component-analysis-pca"><span class="header-section-number">8</span> Principal component analysis (PCA)</a></li>
<li><a class="nav-link" href="#objectives-6"><span class="header-section-number">8.1</span> Objectives</a></li>
<li><a class="nav-link" href="#purpose-and-aim-1"><span class="header-section-number">8.2</span> Purpose and aim</a></li>
<li><a class="nav-link" href="#libraries-and-functions-4"><span class="header-section-number">8.3</span> Libraries and functions</a></li>
<li><a class="nav-link" href="#data"><span class="header-section-number">8.4</span> Data</a></li>
<li><a class="nav-link" href="#visualise-the-data-4"><span class="header-section-number">8.5</span> Visualise the data</a></li>
<li><a class="nav-link" href="#performing-the-pca"><span class="header-section-number">8.6</span> Performing the PCA</a></li>
<li><a class="nav-link" href="#visualising-pcs"><span class="header-section-number">8.7</span> Visualising PCs</a></li>
<li><a class="nav-link" href="#loadings"><span class="header-section-number">8.8</span> Loadings</a></li>
<li>
<a class="nav-link" href="#exercise-heptathlon"><span class="header-section-number">8.9</span> Exercise: Heptathlon</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#load-the-data"><span class="header-section-number">8.9.1</span> Load the data</a></li>
<li><a class="nav-link" href="#correlations"><span class="header-section-number">8.9.2</span> Correlations</a></li>
<li><a class="nav-link" href="#pca"><span class="header-section-number">8.9.3</span> PCA</a></li>
<li><a class="nav-link" href="#screeplot"><span class="header-section-number">8.9.4</span> Screeplot</a></li>
<li><a class="nav-link" href="#loadings-1"><span class="header-section-number">8.9.5</span> Loadings</a></li>
<li><a class="nav-link" href="#conclusion"><span class="header-section-number">8.9.6</span> Conclusion</a></li>
</ul>
</li>
<li><a class="nav-link" href="#key-points-4"><span class="header-section-number">8.10</span> Key points</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

					</div>
				</div>

			</div>
		</div>
		<div class="campl-row campl-local-footer">
			<div class="campl-wrap clearfix">
				<div class="campl-column3 campl-footer-navigation">
					<div class="campl-content-container campl-navigation-list">
						<h3>Contact us</h3>
						 <div class="content">
						   <p>Bioinformatics Training Department of Genetics University of Cambridge Downing Street Cambridge CB2 3EH United Kingdom</p>
						   <h3>Contact:</h3> <a href="mailto:%20bioinfotraining@bio.cam.ac.uk">bioinfotraining@bio.cam.ac.uk</a>
						 </div>
					</div>
				</div>
				<div class="campl-column3 campl-footer-navigation">
					<div class="campl-content-container campl-navigation-list">
						<h3>Bioinformatics Training</h3>
						<ul class="campl-unstyled-list">
<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/undergraduate">Undergraduate training</a>
							</li>
							<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/postgraduate">Postgraduate training</a>
							</li>
						</ul>
</div>
				</div>
				<div class="campl-column3 campl-footer-navigation">
					<div class="campl-content-container campl-navigation-list">
						<h3>Postgraduate Courses by Theme</h3>
						<ul class="campl-unstyled-list">
<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/postgraduate/programming">Basic Skills and Programming</a>
							</li>
							<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/postgraduate/services">Databases and Services</a>
							</li>
							<li>
							  <a href="https://bioinfotraining.bio.cam.ac.uk/postgraduate/specialized">Specialised Topics</a>
							</li>
						</ul>
</div>
				</div>
				<div class="campl-column3 campl-footer-navigation last">
					<div class="campl-content-container campl-navigation-list">
						<h3>About Bioinformatics Training</h3>
						<ul class="campl-unstyled-list">
<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/about">About the Facility</a>
							</li>
							<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/about/findus">How to find us</a>
							</li>
							<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/about/visitors">Visiting Cambridge</a>
							</li>
							<li>
								<a href="https://bioinfotraining.bio.cam.ac.uk/privacy-and-cookie-policies">Privacy and Cookies policy</a>
							</li>
						</ul>
</div>
				</div>
			</div>
		</div>

<!--[if lte IE 8]>
</div>
<![endif]-->

	<script type="text/javascript" src="javascripts/libs/ios-orientationchange-fix.js"></script><script type="text/javascript" src="javascripts/libs/jquery-min.js"></script><script type="text/javascript" src="javascripts/libs/modernizr.js"></script><script type="text/javascript" src="javascripts/custom.js"></script><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
